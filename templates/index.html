<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Repair Parts Scout</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: light;
        --ink: #0d1b2a;
        --muted: #4f6073;
        --brand: #0ea5e9;
        --brand-strong: #0284c7;
        --surface: #f8fafc;
        --card: #ffffff;
        --accent: #22c55e;
        --danger: #ef4444;
        --shadow: 0 24px 50px rgba(15, 23, 42, 0.12);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
        background: radial-gradient(circle at 10% 20%, #e0f2fe 0, transparent 25%),
          radial-gradient(circle at 90% 10%, #bae6fd 0, transparent 25%),
          linear-gradient(180deg, #f8fafc 0, #eef2ff 100%);
        color: var(--ink);
      }

      header {
        padding: 24px 32px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 1200px;
        margin: 0 auto;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        font-size: 20px;
        letter-spacing: -0.02em;
        color: var(--ink);
      }

      .pill {
        padding: 6px 12px;
        background: rgba(14, 165, 233, 0.08);
        border: 1px solid rgba(14, 165, 233, 0.15);
        border-radius: 999px;
        font-weight: 600;
        color: var(--brand-strong);
        font-size: 12px;
      }

      main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 32px 72px;
      }

      .hero {
        background: var(--card);
        border-radius: 20px;
        padding: 36px;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
      }

      .hero:after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 80% 20%, rgba(14, 165, 233, 0.15), transparent 45%);
        pointer-events: none;
      }

      .hero h1 {
        margin: 0;
        font-size: 36px;
        line-height: 1.2;
        letter-spacing: -0.03em;
      }

      .hero p {
        margin: 12px 0 20px;
        color: var(--muted);
        max-width: 720px;
      }

      .search-card {
        margin-top: 24px;
        background: rgba(14, 165, 233, 0.05);
        border: 1px solid rgba(14, 165, 233, 0.15);
        border-radius: 16px;
        padding: 20px;
        display: grid;
        gap: 12px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
      }

      @media (max-width: 720px) {
        .form-row {
          grid-template-columns: 1fr;
        }
      }

      input[type="text"] {
        padding: 14px 16px;
        border-radius: 12px;
        border: 1px solid rgba(15, 23, 42, 0.1);
        font-size: 16px;
        width: 100%;
        outline: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease;
      }

      input[type="text"]:focus {
        border-color: var(--brand);
        box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.18);
      }

      button.primary {
        padding: 14px 18px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(135deg, var(--brand), var(--brand-strong));
        color: #fff;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 16px 30px rgba(14, 165, 233, 0.35);
        transition: transform 0.1s ease, box-shadow 0.2s ease;
      }

      button.primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 20px 35px rgba(14, 165, 233, 0.35);
      }

      .options {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        color: var(--muted);
        font-size: 14px;
      }

      .checkbox {
        display: flex;
        gap: 8px;
        align-items: center;
        cursor: pointer;
      }

      .chips {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .chip {
        background: var(--card);
        border: 1px solid rgba(15, 23, 42, 0.08);
        padding: 8px 12px;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 600;
        color: var(--ink);
        transition: transform 0.1s ease, box-shadow 0.2s ease;
      }

      .chip:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
      }

      .grid {
        display: grid;
        gap: 16px;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        margin-top: 28px;
      }

      .card {
        background: var(--card);
        border-radius: 16px;
        padding: 16px;
        box-shadow: var(--shadow);
        display: grid;
        gap: 12px;
        border: 1px solid rgba(15, 23, 42, 0.05);
      }

      .card .vendor {
        font-weight: 700;
        color: var(--ink);
      }

      .price-line {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 18px;
        font-weight: 700;
      }

      .tag {
        padding: 6px 10px;
        border-radius: 10px;
        font-weight: 700;
        font-size: 12px;
        width: fit-content;
      }

      .tag.success {
        background: rgba(34, 197, 94, 0.12);
        color: #15803d;
      }

      .tag.warn {
        background: rgba(239, 68, 68, 0.12);
        color: #b91c1c;
      }

      .tag.neutral {
        background: rgba(79, 96, 115, 0.12);
        color: var(--ink);
      }

      .badge {
        padding: 6px 10px;
        background: rgba(14, 165, 233, 0.12);
        color: var(--brand-strong);
        border-radius: 8px;
        font-weight: 700;
        font-size: 12px;
      }

      .title {
        font-weight: 700;
        font-size: 16px;
        line-height: 1.4;
      }

      .meta {
        color: var(--muted);
        font-size: 14px;
        display: flex;
        justify-content: space-between;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      .meta a {
        color: var(--brand-strong);
        text-decoration: none;
        font-weight: 600;
      }

      .snippet {
        margin: 0;
        color: var(--muted);
        font-size: 14px;
      }

      .empty, .error {
        margin: 28px 0 0;
        padding: 18px;
        border-radius: 12px;
        background: rgba(15, 23, 42, 0.03);
        color: var(--muted);
        border: 1px dashed rgba(15, 23, 42, 0.1);
      }

      .error {
        color: #b91c1c;
        background: rgba(239, 68, 68, 0.05);
        border-color: rgba(239, 68, 68, 0.3);
      }

      .status {
        margin-top: 8px;
        font-size: 14px;
        color: var(--muted);
      }

      .thumb {
        width: 100%;
        height: 160px;
        border-radius: 12px;
        object-fit: cover;
        background: linear-gradient(135deg, #e2e8f0, #f8fafc);
      }
    </style>
  </head>
  <body>
    <header>
      <div class="brand" aria-label="Repair Parts Scout logo">
        <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 6.5v5l3 1.5" />
          <circle cx="12" cy="12" r="9" />
        </svg>
        Repair Parts Scout
      </div>
      <span class="pill">AI-powered sourcing</span>
    </header>

    <main>
      <section class="hero">
        <div style="position: relative; z-index: 2">
          <h1>Find repair parts instantly with Google + AI</h1>
          <p>
            Search Google-backed listings for screens, batteries, tools, and more.
            We prioritize MobileSentrix, Amazon, and Ebay pricing so you can compare faster.
          </p>
          <div class="search-card">
            <form id="searchForm" class="form-row">
              <input
                type="text"
                id="searchInput"
                name="q"
                placeholder="Example: iPhone 13 screen replacement kit"
                autocomplete="off"
                required
              />
              <button class="primary" type="submit">Search parts</button>
            </form>
            <div class="options">
              <label class="checkbox">
                <input type="checkbox" id="inStockOnly" />
                <span>Show in-stock offers only</span>
              </label>
              <div class="chips" aria-label="Suggested searches">
                <span class="chip" data-query="Galaxy S22 charging port">Galaxy S22 charging port</span>
                <span class="chip" data-query="MacBook Pro battery A2338">MacBook Pro battery A2338</span>
                <span class="chip" data-query="Nintendo Switch Joy-Con joystick">Nintendo Switch joystick</span>
              </div>
            </div>
            <div class="status" id="statusText">Type a part name to see Google pricing previews.</div>
          </div>
        </div>
      </section>

      <section>
        <div class="grid" id="results"></div>
        <div id="message"></div>
      </section>
    </main>

    <script>
      const form = document.getElementById('searchForm');
      const input = document.getElementById('searchInput');
      const inStockToggle = document.getElementById('inStockOnly');
      const resultsEl = document.getElementById('results');
      const messageEl = document.getElementById('message');
      const statusText = document.getElementById('statusText');

      const formatPrice = (item) => {
        if (typeof item.price === 'number') return `$${item.price.toFixed(2)}`;
        if (typeof item.price_value === 'number') return `$${item.price_value.toFixed(2)}`;
        if (typeof item.price === 'string' && item.price.trim()) return item.price;
        return 'See offer';
      };

      const badgeForStock = (inStock) =>
        `<span class="tag ${inStock ? 'success' : 'warn'}">${inStock ? 'In stock' : 'Check availability'}</span>`;

      const badgeForResult = (item) => {
        if (item.stock_label) {
          return `<span class="tag neutral">${item.stock_label}</span>`;
        }
        return badgeForStock(!!item.in_stock);
      };

      const renderResult = (item) => {
        const price = formatPrice(item);
        const best = item.best_price ? '<span class="badge">Best price</span>' : '';
        const safeImage = item.image || 'https://placehold.co/600x400?text=Repair+Part';
        return `
          <article class="card">
            <img class="thumb" src="${safeImage}" alt="${item.title || 'Product image'}" loading="lazy" />
            <div class="price-line">${price} ${best}</div>
            <div class="title">${item.title || 'Untitled part'}</div>
            <div class="meta">
              <span class="vendor">${item.source || 'Unknown vendor'}</span>
              <a href="${item.link || '#'}" target="_blank" rel="noreferrer">View offer â†’</a>
            </div>
            ${badgeForResult(item)}
          </article>
        `;
      };

      const setMessage = (html) => {
        messageEl.innerHTML = html;
      };

      const setStatus = (text) => {
        statusText.textContent = text;
      };

      const renderResults = (items) => {
        resultsEl.innerHTML = '';
        if (!items.length) {
          setMessage('<div class="empty">No matches found yet. Try a different model name or part number.</div>');
          return;
        }
        setMessage('');
        resultsEl.innerHTML = items.map(renderResult).join('');
      };

      const searchParts = async (query) => {
        if (!query.trim()) return;
        setStatus('Searching Google listings...');
        setMessage('');
        resultsEl.innerHTML = '';

        try {
          const res = await fetch(`/api/search?q=${encodeURIComponent(query)}&inStock=${inStockToggle.checked}`);
          if (!res.ok) throw new Error('Request failed');
          const data = await res.json();
          if (!Array.isArray(data)) throw new Error('Unexpected response format');
          renderResults(data);
          setStatus(`Showing ${data.length} option${data.length === 1 ? '' : 's'} sorted by best pricing.`);
        } catch (err) {
          console.error(err);
          setStatus('');
          setMessage('<div class="error">We could not load results right now. Please try again.</div>');
        }
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        searchParts(input.value);
      });

      document.querySelectorAll('.chip').forEach((chip) => {
        chip.addEventListener('click', () => {
          input.value = chip.dataset.query;
          searchParts(chip.dataset.query);
        });
      });
    </script>
  </body>
</html>
